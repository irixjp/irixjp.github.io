# 2025年にEmacsでPlaybookを書く

本記事は [Ansible Advent Calendar 2025](https://qiita.com/advent-calendar/2025/ansible) の1日目の記事です。

## はじめに

世の中には数多くのエディタがあります。最近の人気具合を [Text Editor - Popularity Trends](https://ossinsight.io/collections/text-editor/trends/){:target="_blank"} で見ると、vscode が圧倒的に人気があり、次いで neovim となっています。Emacsは残念ながらランキング圏外になっています(一応 spacemacs がランクインしていますが・・・）。

また Stack Overflow の調査結果を元にした [戦国時代だったテキストエディタ界をVisual Studio Codeが天下統一しつつある](https://gigazine.net/news/20210723-the-era-of-visual-studio-code/){:target="_blank"} を見ても、Emacs は安定して低空飛行の状態です。

とはいえ、Emacs は栄枯盛衰の激しいIT業界において半世紀にも渡って利用されおり、そこには他のエディタには無い魅力があるからです。

私自身、Emacs を20年以上使っており、普段の仕事の多くで利用しています。もちろん Ansible Playbook も Emacs で書いています。この記事では、Emacs ではどんな感じで開発を行なっているのかを紹介し、Emacs に興味を持つきっかけにできればと思っています。

## 素のEmacs

Emacs は Windows, Mac, Linux などメジャーな環境ではほぼ使えます。どのプラットフォームにインストールしても、初期状態の Emacs で Plabyook を書くとこんな感じになります。

<div><video controls src="./movies/emacs_1.mp4" muted="true" width="600"></video></div>

はい、ほぼメモ帳に書いているのとおなじような感じになります。基本的なコピー&ペーストやアンドゥといった操作はできますが、通常のショートカットとは異なり、Emacs独自のショートカットを用いる必要があります。

シンタックスハイライトもされず、お世辞にも使いやすいとは言えません。もはや修行です。

でも安心してください。Emacs には Emacs Lisp という言語を使って、いくらでも、それこそエディタという枠を超えて自由に動作を拡張・カスタマイズ可能です。この自由さこそが Emacs の真骨頂だとも言えます。自分の手癖に馴染むようにどこまでも事細かに挙動を変更できるため、一度自分に最適化して調整して、それに慣れてしまうと離れがたくなってしまうのです。

## 自分流にカスタマイズしたEmacs

自分が普段使っている Emacs 環境で Playbook を書くとこんな感じになります。

<div><video controls src="./movies/emacs_2.mp4" muted="true" width="600"></video></div>

一般的なエディタと同様に、シンタックスハイライトされ、インデントの深さが可視化され、CoPilot と連携してコード生成も使えちゃうのです。

### 生成AIを使ったコードのリライト・リファクタリング

生成AIとの連携でコードのリライトやリファクターをさせることも可能です。以下は ChatGPT を使って Playbook の一部をインラインでリライトしている様子です。

<div><video controls src="./movies/emacs_3.mp4" muted="true" width="600"></video></div>

### たまに便利なマルチカーソル

vim や vscode で使えるマルチカーソルもいけちゃいます。複数の場所にちょっとした文字列を差し込みたいときに便利です(置換の正規表現を考えるのが面倒なときに使います)

<div><video controls src="./movies/emacs_4.mp4" muted="true" width="600"></video></div>

## 個人的によく使う Emacs のパッケージ

Emacs では動作を拡張・カスタマイズするための Emacs Lisp が世界中で開発されており、パッケージとして配布されています。これらをパッケージマネージャーを使って簡単に導入することができます。

### 今回の動画に登場しているもの
  - [yaml-mode](https://github.com/yoshiki/yaml-mode){:target="_blank"} YAMLのインタックスハイライト要
  - [highlight-indent-guides](https://github.com/DarthFennec/highlight-indent-guides){:target="_blank"} インデントの深さを可視化
  - [copilot](https://github.com/copilot-emacs/copilot.el){:target="_blank"} CoPilot連携
  - [gptel](https://github.com/karthink/gptel){:target="_blank"} 様々な生成AIと連携するためのフロントエンド機能
  - [multi-cursors](https://github.com/magnars/multiple-cursors.el){:target="_blank"} マルチカーソル機能

### 個人的によく使っているもの
  - [corfu](https://github.com/minad/corfu){:target="_blank"} 入力補完
  - [vertico](https://github.com/minad/vertico){:target="_blank"} / [consult](https://github.com/minad/consult){:target="_blank"} 入力補完(機能選択やファイル選択)
  - dired ファイラー(Emacs標準搭載)
  - [migemo](https://github.com/emacs-jp/migemo){:target="_blank"} ローマ字入力で日本語検索を可能にする
  - [perspective](https://github.com/nex3/perspective-el){:target="_blank"} ワークスペースを複数作って、ウインド構成やバッファの場所を分ける
  - [expand-region](https://github.com/magnars/expand-region.el){:target="_blank"} 選択範囲を単語単位や文節単位で伸ばしたり縮めたりできる
  - [which-key](https://github.com/justbur/emacs-which-key){:target="_blank"} Emacsのショートカットのヘルプを表示
  - [magit](https://github.com/magit/magit){:target="_blank"} Emacs上から git 操作するためのフロントエンド
  - [open-junk-file](https://github.com/rubikitch/open-junk-file/blob/master/open-junk-file.el){:target="_blank"} ちょっとしたメモを記録するためのファイルを作成
  - [pdf-tools](https://github.com/politza/pdf-tools){:target="_blank"} Emacs上で pdfを表示する(diredとセットで使ってます)
  - org-mode メモからドキュメント作成、TODO管理、スケジュール管理などができる万能ツール(標準搭載) これから離れられないからEmacsを使ってるまであるかも

## おわりに

自分が普段使っている環境を元にEmacsでのPlaybook作成環境を紹介させていただきました。モダンな vscode にも勝るとも劣らないのではないでしょうか？（言い過ぎ？）

普段使っている道具を変えるのは大変だと思いますが、気が向いたときにサブのエディタとして利用して気分を変えるのも良いと思います。いつもと違う気分でコーディングに向き合えるはずです。

年末年始の空き時間にでもぜひお試しください。
