# Ansible x AI = AIOps

本記事は [Ansible Advent Calendar 2025](https://qiita.com/advent-calendar/2025/ansible){:target="_blank"} の4日目の記事です。

## はじめに

最近のAIの発展の勢いは目覚ましく、日々の業務に活用している方も多いのではないでしょうか。

これは Ansible を用いたインフラ構築や運用も例外では無く、様々なAIと組み合わせた活用が行われています。いくつか代表的な方法を確認してみます。

1. AI で Playbook を生成(ChatGPT, CoPilot, Ansible Lightspeed, etc)
2. AI からAnsible を実行(AI Agent, MCP, etc)
3. Ansible から AI へプロンプトを送信する(今回の記事で取り上げます)

1は Playbook の開発に便利で、既に活用しているかたも多いと思います。2はこれから発展や応用が期待される分野で、AI の判断を元にして AI Agent や MCP を通して、Ansible の Playbook を実行します。

そして、今回は3の「Ansible から AI へプロンプトを送信」するに焦点を当てます。これは従来は AIBot に対して人間がチャットを通してプロンプトを送信していた部分をAnsibleに自動化させるというものです。一見すると大したことが無いように見えます（実際にPlaybookとしては簡単です）が、使ってみると想像以上に便利です。

では、これより本題です。

## AI にプロンプトを投げるPlaybook

これは非常に簡単です。ほとんどのAIはAPIでリクエストを受け付けてくれますので、それをPlaybookから叩くだけです。

例えばこんな感じです。

[https://github.com/irixjp/aap-demos/blob/main/aiops/ask_to_chatgps.yaml](https://github.com/irixjp/aap-demos/blob/main/aiops/ask_to_chatgps.yaml){:target="_blank"}
```yaml
    - name: Create prompt
      set_fact:
        gpt_prompt: |
          これは {{ error_source }} です。
          ログから原因の推定と、調査方法、可能であればエラーへの対処方法を教えて下さい
          (markdown形式で出力)

          {{ error_logs }}

    - name: send prompt
      ansible.builtin.uri:
        url: "{{ ai_api_endpoint }}"
        method: POST
        headers:
          Content-Type: "application/json"
          Authorization: "Bearer {{ lookup('env', 'gpt_token') }}"
        body:
          model: "{{ ai_model }}"
          messages:
            - role: user
              content: "{{ gpt_prompt }}"
        body_format: json
        return_content: true
        timeout: 300
      register: ai_ret
```

この Playbook では最初のタスクでAIへ送信するプロンプトを作成し、次のタスクでプロンプトをAIへ送信しています。AIの回答は変数に格納されます。実に簡単なPlaybookです。

これだけですと、チャットで人間が指示するものを置き換えているだけですが、ここに「[サーバーから分析対象の情報を取得するPlaybook](){:target="_blank"}」「[AIからの回答をチケットに書き込むPlaybook](){:target="_blank"}」を組み合わせると利便性が大きく恒常します。

つまり、以下のような自動化が行えるようになります。

1. 対象のサーバーやネットワーク機器からログや状態を取得する [get_linux_logs.yaml](https://github.com/irixjp/aap-demos/blob/main/aiops/get_linux_logs.yaml){:target="_blank"}
2. 取得した状態をプロンプトをAIへ送信する [ask_to_chatgpt.yaml](https://github.com/irixjp/aap-demos/blob/main/aiops/ask_to_chatgps.yaml){:target="_blank"}
3. AIからの回答をチケットへ書き込む [redmine_create_issue.yaml](https://github.com/irixjp/aap-demos/blob/main/aiops/redmine_create_issue.yaml){:target="_blank"}

これは、障害対応などの初動の動きを自動化してくれます。シンプルですが非常に便利です。更に監視システムと連携させれば、障害に連動して初動の分析までを自動化で実施できます。

## 応用

この方法はシンプルで単純が故に応用が聞きます。例えば以下の様に使えます。

| ステップ | 応用 |
| ------------- | ------------- |
| 情報の取得  | Ansibleが操作できるサーバーやネットワーク機器であれば、どんな情報でも取得し、同時に複数台からも収集可能  |
| プロンプト構築  | 単純な原因分析から、対策の方法の問い合わせ、潜在的な設定不備やセキュリティ上のリスク見、 複数台のログから類似の事象を見つける、など多岐にわたる|
| AIへのプロンプト送信  | API連携可能なAIであれば何でも使用可能  |
| 結果の通知 | チケット作成・追記、Chatやメールへの送信など、API連携可能なものであれば何でも通知可能 |






